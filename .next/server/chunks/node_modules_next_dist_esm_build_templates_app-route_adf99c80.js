module.exports=[3904,e=>{"use strict";var t=e.i(47909),r=e.i(74017),n=e.i(96250),a=e.i(59756),i=e.i(61916),o=e.i(74677),s=e.i(69741),l=e.i(16795),u=e.i(87718),d=e.i(95169),c=e.i(47587),p=e.i(66012),f=e.i(70101),h=e.i(26937),g=e.i(10372),m=e.i(93695);e.i(52474);var R=e.i(5232),v=e.i(1700),w=e.i(89660);let N=Symbol.for("constructDateFrom");function C(e,t){return"function"==typeof e?e(t):e&&"object"==typeof e&&N in e?e[N](t):e instanceof Date?new e.constructor(t):new Date(t)}function x(e,t){return C(t||e,e)}function y(e,t){let r,n,a=()=>C(t?.in,NaN),i=t?.additionalDigits??2,o=function(e){let t,r={},n=e.split(E);if(n.length>2)return r;if(/:/.test(n[0])?t=n[0]:(r.date=n[0],t=n[1],T.test(r.date)&&(r.date=e.split(T)[0],t=e.substr(r.date.length,e.length))),t){let e=D.exec(t);e?(r.time=t.replace(e[1],""),r.timezone=e[1]):r.time=t}return r}(e);if(o.date){let e=function(e,t){let r=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),n=e.match(r);if(!n)return{year:NaN,restDateString:""};let a=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:null===i?a:100*i,restDateString:e.slice((n[1]||n[2]).length)}}(o.date,i);r=function(e,t){var r,n,a,i,o,s,l,u,d,c;if(null===t)return new Date(NaN);let p=e.match(_);if(!p)return new Date(NaN);let f=!!p[4],h=A(p[1]),g=A(p[2])-1,m=A(p[3]),R=A(p[4]),v=A(p[5])-1;if(f){let e,s;return(r=R,n=v,r>=1&&r<=53&&n>=0&&n<=6)?(a=t,i=R,o=v,(e=new Date(0)).setUTCFullYear(a,0,4),s=e.getUTCDay()||7,e.setUTCDate(e.getUTCDate()+((i-1)*7+o+1-s)),e):new Date(NaN)}{let e=new Date(0);return(s=t,l=g,u=m,l>=0&&l<=11&&u>=1&&u<=(I[l]||(P(s)?29:28))&&(d=t,(c=h)>=1&&c<=(P(d)?366:365)))?(e.setUTCFullYear(t,g,Math.max(h,m)),e):new Date(NaN)}}(e.restDateString,e.year)}if(!r||isNaN(+r))return a();let s=+r,l=0;if(o.time&&isNaN(l=function(e){var t,r,n;let a=e.match(U);if(!a)return NaN;let i=S(a[1]),o=S(a[2]),s=S(a[3]);return(t=i,r=o,n=s,24===t?0===r&&0===n:n>=0&&n<60&&r>=0&&r<60&&t>=0&&t<25)?36e5*i+6e4*o+1e3*s:NaN}(o.time)))return a();if(o.timezone){if(isNaN(n=function(e){var t;if("Z"===e)return 0;let r=e.match(b);if(!r)return 0;let n="+"===r[1]?-1:1,a=parseInt(r[2]),i=r[3]&&parseInt(r[3])||0;return(t=i)>=0&&t<=59?n*(36e5*a+6e4*i):NaN}(o.timezone)))return a()}else{let e=new Date(s+l),r=x(0,t?.in);return r.setFullYear(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()),r.setHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),e.getUTCMilliseconds()),r}return x(s+l+n,t?.in)}let E=/[T ]/,T=/[Z ]/i,D=/([Z+-].*)$/,_=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,U=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,b=/^([+-])(\d{2})(?::?(\d{2}))?$/;function A(e){return e?parseInt(e):1}function S(e){return e&&parseFloat(e.replace(",","."))||0}let I=[31,null,31,30,31,30,31,31,30,31,30,31];function P(e){return e%400==0||e%4==0&&e%100!=0}var k=e.i(89171),O=e.i(69719);let j=O.z.object({qrData:O.z.string()});async function q(e){try{let t=await (0,w.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)return k.NextResponse.json({error:"Unauthorized"},{status:401});let n=await e.json(),{qrData:a}=j.parse(n),i=(0,v.verifyQRCode)(a);if(!i)return k.NextResponse.json({error:"Invalid or expired QR code"},{status:400});let{data:o}=await t.from("bookings").select(`
        *,
        turf:turfs(owner_id, name),
        sport:sports(name),
        slot:slots(start_time, end_time),
        customer:profiles(name, phone)
      `).eq("id",i.bookingId).single();if(!o)return k.NextResponse.json({error:"Booking not found"},{status:404});if(o.turf.owner_id!==r.id)return k.NextResponse.json({error:"Unauthorized"},{status:403});if("accepted"!==o.status)return k.NextResponse.json({error:"Booking is not accepted"},{status:400});if(o.verified_at)return k.NextResponse.json({message:"Booking already verified",booking:o,alreadyVerified:!0});let s=new Date,l=y(o.slot.start_time),u=y(o.slot.end_time),d=new Date(l.getTime()-18e5);if(!function(e,t,r){let n=+x(e,void 0),[a,i]=[+x(t.start,void 0),+x(t.end,void 0)].sort((e,t)=>e-t);return n>=a&&n<=i}(s,{start:d,end:u}))return k.NextResponse.json({error:"Check-in time is outside the allowed window",slotTime:{start:o.slot.start_time,end:o.slot.end_time}},{status:400});let{data:c,error:p}=await t.from("bookings").update({verified_at:new Date().toISOString()}).eq("id",i.bookingId).select(`
        *,
        turf:turfs(name),
        sport:sports(name),
        slot:slots(start_time, end_time),
        customer:profiles(name, phone)
      `).single();if(p)return k.NextResponse.json({error:p.message},{status:500});return k.NextResponse.json({message:"Booking verified successfully",booking:c})}catch(e){if(e instanceof O.z.ZodError)return k.NextResponse.json({error:e.errors},{status:400});return k.NextResponse.json({error:"Internal server error"},{status:500})}}e.s(["POST",()=>q],16888);var H=e.i(16888);let M=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/qr/verify/route",pathname:"/api/qr/verify",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/qr/verify/route.ts",nextConfigOutput:"",userland:H}),{workAsyncStorage:F,workUnitAsyncStorage:$,serverHooks:z}=M;function B(){return(0,n.patchFetch)({workAsyncStorage:F,workUnitAsyncStorage:$})}async function K(e,t,n){M.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/qr/verify/route";v=v.replace(/\/index$/,"")||"/";let w=await M.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:N,params:C,nextConfig:x,parsedUrl:y,isDraftMode:E,prerenderManifest:T,routerServerContext:D,isOnDemandRevalidate:_,revalidateOnlyGenerated:U,resolvedPathname:b,clientReferenceManifest:A,serverActionsManifest:S}=w,I=(0,s.normalizeAppPath)(v),P=!!(T.dynamicRoutes[I]||T.routes[b]),k=async()=>((null==D?void 0:D.render404)?await D.render404(e,t,y,!1):t.end("This page could not be found"),null);if(P&&!E){let e=!!T.routes[b],t=T.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await k();throw new m.NoFallbackError}}let O=null;!P||M.isDev||E||(O="/index"===(O=b)?"/":O);let j=!0===M.isDev||!P,q=P&&!j;S&&A&&(0,o.setManifestsSingleton)({page:v,clientReferenceManifest:A,serverActionsManifest:S});let H=e.method||"GET",F=(0,i.getTracer)(),$=F.getActiveScopeSpan(),z={params:C,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n,a)=>M.onRequestError(e,t,n,a,D)},sharedContext:{buildId:N}},B=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),L=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let o=async e=>M.handle(L,z).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=F.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${H} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${H} ${v}`)}),s=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var i,l;let u=async({previousCacheEntry:r})=>{try{if(!s&&_&&U&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(a);e.fetchMetrics=z.renderOpts.fetchMetrics;let l=z.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=z.renderOpts.collectedTags;if(!P)return await (0,p.sendResponse)(B,K,i,z.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[g.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==z.renderOpts.collectedRevalidate&&!(z.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&z.renderOpts.collectedRevalidate,n=void 0===z.renderOpts.collectedExpire||z.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:z.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await M.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:_})},!1,D),t}},d=await M.handleResponse({req:e,nextConfig:x,cacheKey:O,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:U,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:s});if(!P)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",_?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,f.fromNodeOutgoingHttpHeaders)(d.value.headers);return s&&P||m.delete(g.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,h.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(B,K,new Response(d.value.body,{headers:m,status:d.value.status||200})),null};$?await l($):await F.withPropagatedContext(e.headers,()=>F.trace(d.BaseServerSpan.handleRequest,{spanName:`${H} ${v}`,kind:i.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},l))}catch(t){if(t instanceof m.NoFallbackError||await M.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:_})},!1,D),P)throw t;return await (0,p.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>K,"patchFetch",()=>B,"routeModule",()=>M,"serverHooks",()=>z,"workAsyncStorage",()=>F,"workUnitAsyncStorage",()=>$],3904)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_adf99c80.js.map